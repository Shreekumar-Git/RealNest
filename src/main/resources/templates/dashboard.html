<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Customer Dashboard - Real Estate Platform</title>

    <!-- ‚úÖ Bootstrap 5.3 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- üå§Ô∏è Modern Light Blue Theme -->
    <style>
      :root {
        --accent: #3b82f6; /* Primary blue */
        --accent-light: #60a5fa; /* Hover blue */
        --danger: #dc3545;
        --bg-main: #f5f7fa; /* Light gray-blue */
        --card-bg: #ffffff;
        --text-dark: #1f2937; /* Neutral dark gray */
      }

      body {
        background-color: var(--bg-main);
        font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: var(--text-dark);
        margin: 0;
        padding: 40px 20px;
      }

      .dashboard-container {
        max-width: 1000px;
        margin: auto;
        background: var(--card-bg);
        border-radius: 12px;
        padding: 36px;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      h1 {
        text-align: center;
        color: var(--accent);
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 20px;
      }

      h2 {
        color: var(--accent);
        font-size: 1.3rem;
        margin-top: 30px;
        margin-bottom: 18px;
        font-weight: 600;
      }

      /* Buttons (Home and Add Property) */
      .action-btn {
        display: inline-block;
        padding: 10px 18px;
        background-color: var(--accent);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.1s;
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.15);
      }

      .action-btn:hover {
        background-color: var(--accent-light);
        transform: translateY(-2px);
        color: white;
      }

      /* Property grid and cards */
      .property-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .property-card {
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .property-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      }

      .property-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }

      .property-card .details {
        padding: 14px 16px;
      }

      .property-card h3 {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 6px;
      }

      .property-card p {
        margin: 4px 0;
        font-size: 0.95rem;
        color: #374151;
      }

      .property-card button,
      .property-card a {
        margin-right: 10px;
        margin-top: 8px;
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        color: #fff;
        font-weight: 600;
        font-size: 0.9rem;
        transition: background-color 0.2s ease, transform 0.1s;
        display: inline-block;
      }

      .property-card a {
        background-color: var(--accent);
      }

      .property-card a:hover {
        background-color: var(--accent-light);
      }

      .property-card button {
        background-color: var(--danger);
      }

      .property-card button:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }

      @media (max-width: 640px) {
        .dashboard-container {
          padding: 22px;
        }
        h1 {
          font-size: 1.6rem;
        }
        .property-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="dashboard-container">
      <h1>Customer Dashboard</h1>

      <!-- ‚úÖ Back to Home Button -->
      <div class="text-center mb-3">
        <a href="/webpages/" class="action-btn">üè† Back to Home</a>
      </div>

      <h2>Add Properties</h2>
      <div class="text-center mb-4">
        <a href="/webpages/properties/new" class="action-btn"
          >‚ûï Add New Property</a
        >
      </div>

      <h2>Your Properties</h2>
      <div class="property-grid" id="user-properties">
        Loading properties...
      </div>
    </div>

    <!-- ‚úÖ Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const token = localStorage.getItem("token");
      if (!token) window.location.href = "/webpages/login";

      async function loadProperties() {
        const email = JSON.parse(atob(token.split(".")[1])).sub;

        const res = await fetch(`/api/properties/owner?email=${email}`, {
          headers: { Authorization: "Bearer " + token },
        });
        const properties = await res.json();
        const container = document.getElementById("user-properties");

        if (properties.length === 0) {
          container.innerHTML =
            '<p class="text-center text-muted">No properties added yet.</p>';
          return;
        }

        container.innerHTML = properties
          .map(
            (p) => `
        <div class="property-card">
          <img src="${
            p.imageUrl || "https://via.placeholder.com/300x200?text=No+Image"
          }" alt="${p.title}">
          <div class="details">
            <h3>${p.title}</h3>
            <p>${p.description}</p>
            <p><strong>Price:</strong> ‚Çπ${p.price}</p>
            <p><strong>Type:</strong> ${p.type}</p>
            <p><strong>Location:</strong> ${p.location}</p>
            <div>
              <button onclick="deleteProperty(${
                p.id
              }, '${email}')">Delete</button>
              <a href="/webpages/properties/edit/${p.id}">Edit</a>
            </div>
          </div>
        </div>
      `
          )
          .join("");
      }

      async function deleteProperty(id, email) {
        const confirmed = confirm(
          "Are you sure you want to delete this property?"
        );
        if (!confirmed) return;

        await fetch(`/api/properties/delete/${id}?email=${email}`, {
          method: "DELETE",
          headers: { Authorization: "Bearer " + token },
        });
        loadProperties();
      }

      loadProperties();
    </script>
  </body>
</html>
