<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Add / Edit Property - Real Estate Platform</title>

    <!-- ‚úÖ Bootstrap 5.3 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- üå§Ô∏è Modern Light Blue Theme -->
    <style>
      :root {
        --accent: #3b82f6; /* Modern blue */
        --accent-light: #60a5fa; /* Hover blue */
        --bg-main: #f5f7fa; /* Light blue-gray */
        --card-bg: #ffffff;
        --text-dark: #1f2937;
        --danger: #dc3545;
      }

      body {
        background: linear-gradient(180deg, #eaf1fb 0%, #f5f7fa 100%);
        font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: var(--text-dark);
        margin: 0;
        padding: 40px 20px;
        display: flex;
        align-items: flex-start;
        justify-content: center;
      }

      .form-card {
        width: 100%;
        max-width: 540px;
        background-color: var(--card-bg);
        border-radius: 14px;
        padding: 32px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      h1 {
        text-align: center;
        color: var(--accent);
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin: 12px 0 6px;
        color: var(--text-dark);
        font-weight: 600;
        font-size: 0.95rem;
      }

      input[type="text"],
      input[type="number"],
      input[type="file"],
      select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #ced4da;
        background: #f9fafb;
        font-size: 0.95rem;
        color: var(--text-dark);
        transition: all 0.2s ease;
      }

      input:focus,
      select:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        outline: none;
      }

      button[type="submit"] {
        width: 100%;
        margin-top: 20px;
        padding: 12px;
        background-color: var(--accent);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.2s ease, transform 0.1s;
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.15);
      }

      button[type="submit"]:hover {
        background-color: var(--accent-light);
        transform: translateY(-2px);
      }

      .back-dashboard {
        display: inline-block;
        padding: 10px 18px;
        background-color: var(--accent);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: background-color 0.2s ease, transform 0.1s;
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.18);
        margin-bottom: 20px;
      }

      .back-dashboard:hover {
        background-color: var(--accent-light);
        transform: translateY(-2px);
      }

      .hint {
        display: block;
        margin-top: 8px;
        color: #6b7280;
        font-size: 0.9rem;
      }

      @media (max-width: 640px) {
        body {
          padding: 20px;
        }
        .form-card {
          padding: 24px;
          border-radius: 10px;
        }
        h1 {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="form-card">
      <h1>Add / Edit Property</h1>

      <!-- üîô Back to Dashboard -->
      <div class="text-center">
        <a href="/webpages/dashboard" class="back-dashboard"
          >üè† Back to Dashboard</a
        >
      </div>

      <form id="property-form">
        <label>Title:</label>
        <input type="text" id="title" required />

        <label>Description:</label>
        <input type="text" id="description" required />

        <label>Price:</label>
        <input type="number" id="price" required />

        <label>Type:</label>
        <select id="type">
          <option value="SALE">Sale</option>
          <option value="RENT">Rent</option>
        </select>

        <label>Location:</label>
        <input type="text" id="location" required />

        <label>Image:</label>
        <input type="file" id="imageFile" />

        <button type="submit">Save Property</button>
      </form>
    </div>

    <!-- ‚úÖ Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const token = localStorage.getItem("token");
      if (!token) window.location.href = "/webpages/login";

      const path = window.location.pathname;
      const id = path.includes("/edit/") ? path.split("/").pop() : null;

      async function loadProperty() {
        if (id) {
          const res = await fetch(`/api/properties`);
          const properties = await res.json();
          const property = properties.find((p) => p.id == id);
          if (property) {
            document.getElementById("title").value = property.title;
            document.getElementById("description").value = property.description;
            document.getElementById("price").value = property.price;
            document.getElementById("type").value = property.type;
            document.getElementById("location").value = property.location;
          }
        }
      }

      document
        .getElementById("property-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData();
          const property = {
            title: document.getElementById("title").value,
            description: document.getElementById("description").value,
            price: parseFloat(document.getElementById("price").value),
            type: document.getElementById("type").value,
            location: document.getElementById("location").value,
          };
          formData.append("property", JSON.stringify(property));
          const file = document.getElementById("imageFile").files[0];
          if (file) formData.append("imageFile", file);

          const email = JSON.parse(atob(token.split(".")[1])).sub;
          const url = id
            ? `/api/properties/update/${id}`
            : `/api/properties/create?ownerEmail=${email}`;
          const method = id ? "PUT" : "POST";

          await fetch(url, {
            method: method,
            headers: { Authorization: "Bearer " + token },
            body: formData,
          });

          window.location.href = "/webpages/dashboard";
        });

      loadProperty();
    </script>
  </body>
</html>
